
<!DOCTYPE html>
<html lang="en">
<!-- default layout-->
<!--map layout see _layouts/map.html-->

<head>
  <!--meta content and open graph tags for social sharing see _includes/metal.html-->
  <title>Scott Township Parcel Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- <link href='//fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400italic,400,800,700|Archivo+Narrow:400,700|Archivo+Black' rel='stylesheet' type='text/css'>-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js" integrity="sha256-wS9gmOZBqsqWxgIVgA8Y9WcQOa7PgSIX+rPA0VL2rbQ="
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
   <!--  <link href="assets/css/leaflet-panel-layers.min.css" rel="stylesheet"> -->

  <!-- <script src="https://maps.google.com/maps/api/js?v=3"></script> -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.7/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@0.7.7/dist/leaflet.js"></script>
  

  <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script> -->

  <link rel="stylesheet" href="assets/css/custom-leaflet-0.7.css" />
   <!--  <link rel="stylesheet" href="assets/css/leaflet-measure.css" /> -->
  
  <script src="assets/js/custom-leaflet-0.7.js"></script>
    <script src="assets/js/leaflet-panel-layers.js"></script>
    <!-- <script src="assets/js/leaflet-measure.min.js"></script> -->

  <link rel="stylesheet" href="assets/css/custom-ui.css" />

  <style>
    * {
      font-family: "Open Sans", sans-serif;
    }
    hr {
      margin-top: 10px;
      margin-bottom: 10px;
    }
    
  </style>


</head>

<body>
  <!--
    <script src="assets/js/geojson-vt.js"></script>
  <script src="assets/js/L.CanvasTiles.js"></script>
  <script src="data/parcelstopo.json"></script>
  <script src="data/zoning.geojson"></script>
  <script src="data/floodplains.geojson"></script>
  <script src="data/muni.geojson"></script>
  <script src="data/wetlands.geojson"></script>
  <script src="data/buildingfootprints2007.geojson"></script>
  <script src="data/addresspoints.geojson"></script>
  -->
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-pip/v0.1.0/leaflet-pip.min.js'></script>

  <!-- <div class="blank"><h2 class="animate-flicker" style="text-align:center;margin-top:50px;">Loading...</h2></div> -->
  <div id='map'>
    <div id="sidebar">
      <h2 style="font-family:Archivo Black, sans-serif;">Scott Township</h2>
      <h3 style="font-family:Archivo Black, sans-serif;">Lackawanna County, Pa.</h3>
      <h5 style="font-family:Archivo Black, sans-serif;">
      Address: 1038 Montdale Rd. Scott Township PA 18447<br>
      Phone: 570-319-1296<br>
      Fax 570-319-1321<br>
      Hours: 9:00 A.M. â€“ 3:00 P.M., Monday through Friday<br>
      E-mail Address: Secretary@Scotttownship.org</span></h5>
      <hr />
      <strong>Use zoom controls to navigate the map. Pinch & zoom and double tap to zoom have been disabled.</strong>
      <hr />
      <em>The parcels shown are for informational purposes only. <br>Map data is only updated once or so per year.</em>

      <div>
        <hr />
        <button id="showTools" type="button" class="btn btn-default btn-xs btn-block">Show Map Tools Legend</button>
        <button id="hideTools" type="button" class="btn btn-default btn-xs btn-block" style="display:none;">Hide Map Tools Legend</button>
        <div class="toolLegend" style="display:none;">
          <hr />
          <div class="list-group" style="text-align:left;">
            <li class="list-group-item">
              <i class='fa fa-bars fa-fw fa-lg'></i> Open Sidebar</li>

            <li class="list-group-item">
              <i class='fa fa-exchange fa-fw fa-lg'></i> Toggle Address Search</li>

            <li class="list-group-item">
              <img src="assets/images/fullscreen-img.png" style="padding:0 1px;width:22px;"></img> Fullscreen</li>
            <li class="list-group-item">
              <i class='fa fa-globe fa-fw fa-lg'></i> Default Map Extent</li>
            <li class="list-group-item">
              <i class='fa fa-map-marker fa-fw fa-lg'></i> Show/Follow Your Location</li>

            <li class="list-group-item">
              <i class='fa fa-cogs fa-fw fa-lg'></i> Toggle Map Tools (Mobile Only)</li>
            <li class="list-group-item">
              <img src="assets/images/layers-bl.png" style="padding:0 1px;width:22px;"></img> Toggle Map Layers</li>

          </div>
        </div>
        <hr />
      </div>
      <script>
        $("#showTools").click(function () {
          $(".toolLegend").toggle();
          $("#showTools").toggle();
          $("#hideTools").toggle();
        });
        $("#hideTools").click(function () {
          $(".toolLegend").toggle();
          $("#showTools").toggle();
          $("#hideTools").toggle();
        });
      </script>

      <h6><a href='http://scotttownship.org' target='_blank' style='text-decoration:none;'>Scott Township</a> | Map data updated 11/2017.</h6>
      <h6><a href='https://lakedevelopmentgroup.com' target='_blank' style='text-decoration:none;'>By Lake Development Group, Inc</a> | 2016-2018.</h6>
    </div>
  </div>
  <script>
    var tileLayer;
    var zoning, floodplains;
    
    var map = L.map('map', {
      zoomControl: false,
      minZoom: 10,
      touchZoom: false,
      zoomAnimationThreshold: 2,
      doubleClickZoom: false
    }).setView([41.54186311882117, -75.6412124633789], 12);

	var measureControl = L.control.measure({position: 'bottomright'});
	measureControl.addTo(map);
	
    // function mapLoad(){
    //   var bounds = map.getBounds();
    //   console.log(bounds);
    // }
    // map.on("moveend", function(){
    //   var center = map.getCenter();
    //   console.log(center);
    // })
    

    //remove existing attribution control by hiding it only on mobile
    //make sure the normal control is hidden
    var style = document.createElement('style');
    style.type = 'text/css';
    style.innerHTML = '.leaflet-control-attribution {display: none;};@media screen and (max-width:768px) {.elevation.leaflet-control {display:none}}';
    document.getElementsByTagName('head')[0].appendChild(style);

    if (L.Browser.mobile) {

      var toggleAttribution = L.Control.extend({
        options: { position: 'bottomright' },
        onAdd: function (map) {
          this._div = L.DomUtil.create('button', 'btn btn-link');
          this._div.innerHTML = "Leaflet | Map Tiles";
          L.DomEvent.on(this._div, 'click', this._click);
          return this._div;
        },

        _click: function (e) {
          L.DomEvent.stop(e);
          x = document.getElementsByClassName("leaflet-control-attribution")[0];
          x.style.display = x.style.display === 'block' ? '' : 'block';
        },

      });
      map.addControl(new toggleAttribution());
    } else {
      x = document.getElementsByClassName("leaflet-control-attribution")[0];
      x.style.display = x.style.display === 'block' ? '' : 'block';
    }
    //Add link to edit OpenStreetMap at the current map location
    var osmEdit = L.geoJson();
    osmEdit.getAttribution = function () { return "<span id='osmEditLink'><a href='#'>Edit OSM</a></span>"; };
    osmEdit.addTo(map);
    function osmEditAdd() {
      var osmEditLink = document.getElementById('osmEditLink');
      osmEditLink.addEventListener('click', function () {
        var osmEditZoom = map.getZoom();
        var osmEditCenter = map.getCenter();
        //console.log(osmEditCenter);
        window.open("http://www.openstreetmap.org/#map=" + osmEditZoom + "/" + osmEditCenter.lat + "/" + osmEditCenter.lng + "&layers=N");
      });
    }
    document.onload = function () {
      setTimeout(function () { osmEditAdd() }, 5000);
    }
    //End Attribution Toggle
    //--begin map-tiles
    /*var ogrip = L.esri.imageMapLayer({
      url: '//geo.oit.ohio.gov/arcgis/rest/services/OSIP/osip_best_avail_1ft/ImageServer',
    });
    var ogripTiles = L.esri.tiledMapLayer({
      url:'//gis5.oit.ohio.gov/ArcGIS/rest/services/WM_OSIP_II/MapServer/3',
    });*/

    var osm = L.tileLayer('//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxNativeZoom: 19,
      maxZoom: 22,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    });


    var osmhot = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'
    });

    var stamentoner = new L.tileLayer.provider('Stamen.Toner');
    var stamentonerlight = new L.tileLayer.provider('Stamen.TonerLite');
    var watercolor = L.tileLayer('//stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      subdomains: 'abcd',
      maxNativeZoom: 14,
      maxZoom: 17,
      ext: 'png',
    });

    // var thundertransport = L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=44069acaa3c74efb8784566e1c53b66f', {
    //   attribution: '&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    //   maxZoom: 19,
    // });
    var esrigray = L.tileLayer('//server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
      maxNativeZoom: 16,
      maxZoom: 19,
    });
    var esritopo = L.tileLayer('//server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community',
      maxZoom: 22,
      maxNativeZoom: 18,
    });

    //var ortho = L.tileLayer('////https://api.tiles.mapbox.com/v4/mapbox.streets-satellite/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoib3ZyZGMiLCJhIjoiRUtXeFFzZyJ9.ufnW36oC/Zo96m_L9QsAkYg', {
    //  attribution: '<a href="https://mapbox.com/about/maps/">MapBox</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    //  subdomains: 'abcd', maxZoom: 22, maxNativeZoom: 18,
    //});
    //var streets = osm;
    //var topo = esritopo;
    //var light = cdblight;
    //var dark = cdbdark;
    //var transit = thundertransport;
    //var basemaps = {
    //  "<div class='layers-control-img'><img src='images/osm-streets.png'></div> Streets": osm,
    //  "<div class='layers-control-img'><img src='images/mapbox-ortho.png'></div> Satellite": ortho,
    //  "<div class='layers-control-img'><img src= 'images/esri-topo.png'></div> Topography": esritopo
    //,
    //"<div class='layers-control-img'><img src='images/transit.png'></div> Transit": transit,
    //"<div class='layers-control-img'><img src='images/cdb-light.png'></div> Grayscale": cdblight,
    //"<div class='layers-control-img'><img src='images/cdb-dark.png'></div> Dark Matter": cdbdark,
    //};
    var theScale = L.control.scale({ metric: false, imperial: true }).addTo(map);
    //--show google imagery at higher zoom levels
    //--add mpabox back to map after zoom 20
    // map.on('zoomend', function () {
    //   if (map.getZoom() > 18 && map.hasLayer(ortho)) {
    //     map.removeLayer(ortho);
    //     $('.leaflet-control-scale').css('margin-bottom', '25px');
    //     map.addLayer(ggle);
    //   }

    //   if (map.getZoom() < 19 && map.hasLayer(ggle))
    //   {
    //     map.removeLayer(ggle);
    //     $('.leaflet-control-scale').css('margin-bottom', '5px');
    //     map.addLayer(ortho);
    //   }
    // });

    // map.on('baselayerchange', function () {
    //   map.panBy([1,1]);
    //   if (map.getZoom() > 18 && map.hasLayer(ggle)) {
    //     map.removeLayer(ggle);
    //     $('.leaflet-control-scale').css('margin-bottom', '5px');
    //   }
    //   if (map.getZoom() > 18 && map.hasLayer(ortho)) {
    //     map.removeLayer(ortho);
    //     $('.leaflet-control-scale').css('margin-bottom', '25px');
    //     map.addLayer(ggle);
    //   }
    // });



    //var layerControl = L.control.layers(basemaps, null, { position: 'topright', autoZIndex: true }).addTo(map);
    
    var baseLayers = [
      {
        active: true,
        name: "Open Street Map",
        layer: L.tileLayer('//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
      },
      {
        active: false,
        name: "Satellite",
        layer: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')
      },
      {
        active: false,
        name: "Topography",
        layer: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}')
      }
    ];


    // var zoningStyle = {
    //   "color": "#ef1717",
    //   "weight": 2,
    //   "opacity": 0.65,
    //   fillOpacity: 0
    // };
    var muniStyle = {
      "color": "#000",
      "weight": 2,
      "opacity": 1,
      fillOpacity: 0
    };
    var floodplainStyle = {
      "color": "#178eef",
      "weight": 2,
      "opacity": 0.65,
      fillOpacity: 0.5,
      fillColor: '#abd3f4'
    };
    var wetlandsStyle = {
      "color": "#78808c",
      "weight": 1,
      "opacity": 0.65,
      fillOpacity: 0.5,
      fillColor: '#adafb2',
      fillRule: 'evenodd'
    };
    var addressptsStyle = {
      "color": "#37c132",
      "weight": 1,
      "opacity": 0.65
    };
    var buildingsStyle = {
      "color": "#c17e32",
      "weight": 1,
      "opacity": 0.65,
      fillOpacity: 0.5,
      fillColor: '#f4c997'      
    };
    /*
    var overLayers = [
      {
        active: false,
      	name: "Zoning",
        layer: L.geoJson(zoning, {
          style: function(feature) {
            return {
              weight: 2,
              opacity: 1,
              color: 'white',
              dashArray: '3',
              fillOpacity: getZoneOpacity(feature.properties.ZONE),
              fillColor: getZoneColor(feature.properties.ZONE)
            };                
            }
          , onEachFeature: onEachZoningFeature})
      }
      ,{
      	active: false,
      	name: "Floodplains",
      	layer: L.geoJson(floodplains, {style: floodplainStyle})
      }
      ,{
      	active: false,
      	name: "Municipal Boundary",
      	layer: L.geoJson(muni, {style: muniStyle})
      }
      ,{
      	active: false,
      	name: "Wetlands",
      	layer: L.geoJson(wetlands, {style: wetlandsStyle})
      }
      */
      // ,{
      // 	active: false,
      // 	name: "911 Address Points",
      // 	icon: '<i class="icon icon-parking"></i>',
      // 	layer: L.geoJson(addresspts, {style: addressptsStyle, onEachFeature: onEachAddressFeature})
      // }
      /*
      ,{
      	active: false,
      	name: "Buildings",
      	layer: L.geoJson(buildings, {style: buildingsStyle})
      }
    ];
    */
    //var layerControl = new L.Control.PanelLayers(baseLayers, overLayers);
    
    var layerControl = new L.Control.PanelLayers(baseLayers);
    map.addControl(layerControl);
    

    //--end map-tiles
    //--custom icons--//
    var theIcon = L.Icon.extend({
      options: {
        //   shadowUrl: 'leaf-shadow.png',
        iconSize: [32, 37], // size of the icon
        //   shadowSize:   [50, 64], // size of the shadow
        iconAnchor: [16, 35], // point of the icon which will correspond to marker's location
        //  shadowAnchor: [4, 62],  // the same for the shadow
        popupAnchor: [0, -32] // point from which the popup should open relative to the iconAnchor
      }
    });
    //--//
    //--End map-tiles.js--//

    var customZoom = L.control.zoom({ position: 'topright' }).addTo(map);
    /* _includes/map-toolbar.js */
    //console.log('start map toolbar');

    var theMarker = L.icon({
      iconUrl: 'images/map-marker.png',
      //shadowUrl: 'leaf-shadow.png',
      iconSize: [48, 48], // size of the icon
      //shadowSize:   [50, 64], // size of the shadow
      iconAnchor: [24, 42], // point of the icon which will correspond to marker's location - half the width and height of icon
      //shadowAnchor: [4, 62],  // the same for the shadow
      popupAnchor: [0, -42] // point from which the popup should open relative to the iconAnchor
    });
    //end marker

    var overlays;
    var sidebar = L.control.sidebar('sidebar', { autoPan: false, closeButton: false });
    sidebar.addTo(map);
    
    

    //Toggle OSM Search and Feature Search - remove if no feature search
    var hash = L.hash(map);
    var gpsLocate = L.control.locate({ follow: true, locateOptions: { enableHighAccuracy: true } });
    //gpsLocate.addTo(map);
    var homeExtent = L.control.defaultExtent({});
    //homeExtent.addTo(map);
    var fullscreen = L.control.fullscreen();

    var globalsearchToggle = new L.easyButton({
      states: [{
        stateName: 'show',
        icon: 'fa-exchange fa-lg',
        title: 'Search Addresses',
        onClick: function (btn, map) {
          addrsearch.addTo(map);
          btn.state('hide');
        }
      }, {
        stateName: 'hide',
        icon: 'fa-exchange fa-border fa-lg',
        title: 'Search Features',
        onClick: function (btn, map) {
          map.removeControl(addrsearch);
          btn.state('show');
        }
      }]
    });
    globalsearchToggle.addTo(map);

    var loading = L.Control.loading({ position: 'topright' }).addTo(map);
    var sidebarToggle = L.easyButton({
      states: [{
        stateName: 'open-sidebar',      // name the state
        icon: 'fa-bars fa-lg',          // and define it's properties
        title: 'Show Sidebar',          // like it's title
        onClick: function (btn, map) {  // and it's callback
          sidebar.show();
          btn.state('close-sidebar');   // change state on click!
        }
      }, {
        stateName: 'close-sidebar',
        icon: 'fa-times fa-2x',
        title: 'Hide Sidebar',
        onClick: function (btn, map) {
          sidebar.hide();
          btn.state('open-sidebar');
        }
      }],
      id: 'menu',
    });
    var stogglebar = L.easyBar([sidebarToggle], { id: 'toggle' }).addTo(map);
    //var leafletprint = L.easyPrint();//
    //end toolbar
    sidebar.on('hide', function () {
      sidebarToggle.state('open-sidebar');
    });
    sidebar.on('show', function () {
      sidebarToggle.state('close-sidebar');
    });
    //mobile toolbar menu
    //--tools toggle on small screens
    var toolshidden = false;
    var mobilescreen = false;
    var tools = L.easyButton({
      states: [{
        stateName: 'show-tools',   // name the state
        icon: 'fa-cogs fa-lg',          // and define it's properties
        title: 'Show Map Tools', // like it's title
        onClick: function (btn, map) {  // and it's callback
          leafletprint.addTo(map);
          gpsLocate.addTo(map);
          homeExtent.addTo(map);
          fullscreen.addTo(map);
          globalsearchToggle.addTo(map);
          btn.state('hide-tools'); // change state on click!
          toolshidden = false;
          //console.log(toolshidden + ' state changed to hideTools');
        }
      }, {
        stateName: 'hide-tools',
        icon: 'fa-cogs fa-border fa-lg',
        title: 'Hide Map Tools',
        onClick: function (btn, map) {
          //map.removeControl(leafletprint);
          map.removeControl(gpsLocate);
          map.removeControl(homeExtent);
          map.removeControl(fullscreen);
          map.removeControl(globalsearchToggle);
          btn.state('show-tools');
          toolshidden = true;
          //console.log(toolshidden+ ' state changed to showTools');
        }
      }],
      id: 'tools',
    });

    var w = window.innerWidth;

    if (w < 481) {
      tools.addTo(map);
      toolshidden = true;
      mobilescreen = true;
      //console.log('mobile tool toggle');
      //console.log(toolshidden + "mobilescreen: " + mobilescreen);
    } else {
      //leafletprint.addTo(map);
      gpsLocate.addTo(map);
      homeExtent.addTo(map);
      fullscreen.addTo(map);
      globalsearchToggle.addTo(map);
      toolshidden = false;
      //console.log(toolshidden + " " + mobilescreen);
    }
    window.onresize = function () {
      if (toolshidden === true && window.innerWidth > 480 && mobilescreen === true) {
        //leafletprint.addTo(map);
        gpsLocate.addTo(map);
        homeExtent.addTo(map);
        fullscreen.addTo(map);
        globalsearchToggle.addTo(map);

        map.removeControl(tools);
        toolshidden = false;
        mobilescreen = false;
        //console.log(toolshidden + " " + mobilescreen);
      }
      else if (toolshidden === false && mobilescreen === true && window.innerWidth > 481) {
        tools.state('show-tools');
        mobilescreen = false;
        map.removeControl(tools);
        //console.log(toolshidden + "" + mobilescreen);
      }
      else if (toolshidden === false && window.innerWidth < 481 && mobilescreen === false) {
        //map.removeControl(leafletprint);
        map.removeControl(gpsLocate);
        map.removeControl(homeExtent);
        map.removeControl(fullscreen);
        map.removeControl(globalsearchToggle);
        tools.addTo(map);
        toolshidden = true;
        mobilescreen = true;
      }
      else { }
    };
    //--end tools toggle

    map.on('baselayerchange', function () {
      if (L.Browser.mobile) {
        map.on('baselayerchange', function () {
          setTimeout(function () {
            $(".leaflet-control-layers").removeClass("leaflet-control-layers-expanded");
          }, 5000);
        });
      }
    });

    map.spin(true);
    //ortho.addTo(map);
/*
    var stParcels = L.geoJson(null, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup(feature.properties.OWNERNAME)
      },
      style: { color: 'pink' }
    });

	var addressptsLayer = new L.GeoJSON(addresspts, {
			style: function(feature) {
				return {color: 'red' };
			}//,
			//onEachFeature: function(feature, marker) {
			//	marker.bindPopup('<h4 style="color:'+feature.properties.color+'">'+ feature.properties.name +'</h4>');
			//}
		});
	
    var tileData = omnivore.topojson("data/parcelstopo.json", null, stParcels);

    var search;
    var addrsearch;
    tileData.on('ready', function () {
      var bounds = stParcels.getBounds();
      //console.log("parcel bounds are :" + bounds._northEast.lat + " : " + bounds._northEast.lng)

      //add search after parcelsload, so we can get the bounds of the layer to restrict the search
      //Leaflet Search with OSM Geocode
	  //var searchURL = '';
	  ////searchURL = 'https://nominatim.openstreetmap.org/search?format=json&q={s}';
      //searchURL = 'https://nominatim.openstreetmap.org/search?format=json&q={s}&bounded=1&viewbox=' + bounds._northEast.lat + "," + bounds._northEast.lng + ',' + bounds._southWest.lat + "," + bounds._southWest.lng;
	  
      //osmsearch = new L.Control.Search({
      //  url: searchURL,
      //  jsonpParam: 'json_callback',
      //  propertyName: 'display_name',
      //  propertyLoc: ['lat', 'lon'],
      //  circleLocation: false,
      //  autoType: false,
      //  autoCollapse: false,
      //  minLength: 2,
      //  zoom: 13,
      //  textPlaceholder: 'Search Addresses',
      //  collapsed: false
      //});

      //osmsearch.addTo(map);
      //  var circle;
      //  var marker;
      //  osmsearch.on('search_locationfound', function (e) {
      //    osmsearch.collapse();
      //    if (marker) {
      //      map.removeLayer(marker);
      //    }
      //    var name = e.display_name;
      //    marker = new L.marker([e.latlng.lat, e.latlng.lng], { icon: theMarker }).addTo(map);
      //});

	  //initiate search after parcel data has loaded
      addrsearch = new L.Control.Search({
        layer: addressptsLayer,
        propertyName: 'FullAddres',
        initial: false,
        zoom: 17,
        collapsed: false,
        textPlaceholder: 'Search Addresses',
        minLength: 2
      }).addTo(map);

      addrsearch.on('search_locationfound', function (e) {
        addrsearch.collapse();
        setTimeout(function () {
          map.fire('click', { latlng: e.latlng });
        }, 200);
      });
	  

      map.fitBounds(bounds);
      $(".blank").fadeOut();
      map.spin(false);
      setTimeout(function () { sidebar.show() }, 500);

      //initiate search after parcel data has loaded
      search = new L.Control.Search({
        layer: stParcels,
        propertyName: 'OWNERNAME',
        initial: false,
        zoom: 17,
        collapsed: false,
        textPlaceholder: 'Search Owner Name',
        minLength: 2
      }).addTo(map);

      search.on('search_locationfound', function (e) {
        search.collapse();
        setTimeout(function () {
          map.fire('click', { latlng: e.latlng });
        }, 200);
      });

     
      //end search

      //----------
      //start geojson-vt map tiles
      //interaction on the underlying polygon not drawn but represented by the tiles - they draw better
      var highlight;
      map.on('click', function (e) {
        if (highlight) {
          map.removeLayer(highlight)
        }
        var x = e.latlng.lng;
        var y = e.latlng.lat;
        var layerData = leafletPip.pointInLayer([x, y], stParcels, true);
        if (!layerData[0]) {
          console.log('nothing to see here')
        } else {
          map.spin(true);
          var highlightIndex = layerData[0].feature.properties.PRMAP;
          highlight = new L.geoJson(data, {
            filter: function (feature, layer) {
              return feature.properties.PRMAP == highlightIndex
            },
            style: { color: 'red', fillColor: 'red' }
          }).addTo(map);
          //var attributes = highlightIndex.split('-', 2);
          //var name = layerData[0].feature.properties.;
          //var pin  = attributes[1];
          var popup = 'Parcel ID: ' + layerData[0].feature.properties.PRMAP + '<hr>' + layerData[0].feature.properties.OWNERNAME;
          map.on('popupopen', function () {
            map.spin(false)
          });
          map.openPopup(popup, e.latlng);
          map.on('popupclose', function () {
            map.removeLayer(highlight)
          });
        }
      });
      //end point in polygon
*
      //geojson-vt
      var tileOptions = {
        maxZoom: 22,  // max zoom to preserve detail on
        tolerance: 7, // 5 simplification tolerance (higher means simpler)
        extent: 4096, //4096, // 4096 tile extent (both width and height)
        buffer: 64,   // 64 default 64tile buffer on each side
        debug: 0,      // logging level (0 to disable, 1 or 2)
        indexMaxZoom: 0,        // 0 max zoom in the initial tile index
        indexMaxPoints: 100000, // 100000 max number of points per tile in the index
      };

      var data = stParcels.toGeoJSON();
      var tileIndex = geojsonvt(data, tileOptions);
      //take json output from geojson-vt and draw it with the now depricated (in leaflet-beta) L.canvasTiles and code from here - http://blog.sumbera.com/2015/05/31/geojson-vt-on-leaflet/
      tileLayer = L.canvasTiles().params({ debug: false, padding: 50 }).drawing(drawingOnCanvas);
      var pad = 0;
      tileLayer.addTo(map);
      tileLayer.setZIndex(10);

      layerControl.addOverlay({
        name: "Parcels",
        //icon: '<i class="icon icon-water"></i>',
        layer: tileLayer
      });

      function drawingOnCanvas(canvasOverlay, params) {
        var bounds = params.bounds;
        params.tilePoint.z = params.zoom;
        var ctx = params.canvas.getContext('2d');
        ctx.globalCompositeOperation = 'source-over';
        //console.log('getting tile z' + params.tilePoint.z + '-' + params.tilePoint.x + '-' + params.tilePoint.y);

        var tile = tileIndex.getTile(params.tilePoint.z, params.tilePoint.x, params.tilePoint.y);
        if (!tile) {
          return;
        }
        ctx.clearRect(0, 0, params.canvas.width, params.canvas.height);
        var features = tile.features;
        ctx.strokeStyle = 'orange';

        for (var i = 0; i < features.length; i++) {
          var feature = features[i],
            type = feature.type;

          ctx.fillStyle = feature.tags.color ? feature.tags.color : 'transparent';
          ctx.beginPath();

          for (var j = 0; j < feature.geometry.length; j++) {
            var geom = feature.geometry[j];

            if (type === 1) {
              ctx.arc(geom[0] * ratio + pad, geom[1] * ratio + pad, 2, 0, 2 * Math.PI, false);
              continue;
            }
            //console.log("canvas");
            for (var k = 0; k < geom.length; k++) {
              var p = geom[k];
              var extent = 4096;

              var x = p[0] / extent * 256;
              var y = p[1] / extent * 256;
              if (k) ctx.lineTo(x + pad, y + pad);
              else ctx.moveTo(x + pad, y + pad);
            }
          }

          if (type === 3 || type === 1) ctx.fill();
          ctx.stroke();
        }

      };

    });
*/	
    

    


  </script>

  <!--End Map Post Content-->
  <!--_includes/footer.html-->
</body>
<footer>

  <!-- Modal -->
  <div class="modal fade" id="introModal" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Leaflet & Vector Tiles</h2>
        </div>
        <div class="modal-body">
          Scott Township, Lackawanna County, Pa.
        </div>
        <div class="modal-footer">
          <span id="loadingMessage" class="animate-flicker" style="float:left;color:red;"></span>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>

</footer>

</html>